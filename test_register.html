<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-4">Registration API Test</h1>
        
        <button id="testBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-semibold">
            Test Registration API
        </button>
        
        <div id="output" class="mt-6 p-4 bg-gray-50 rounded-lg font-mono text-sm whitespace-pre-wrap"></div>
    </div>

    <script>
        document.getElementById('testBtn').addEventListener('click', async () => {
            const output = document.getElementById('output');
            output.textContent = 'Testing...\n';
            
            try {
                const testData = {
                    name: 'Test User ' + Date.now(),
                    email: 'test_' + Date.now() + '@example.com',
                    password: 'test123456',
                    role: 'faculty'
                };
                
                output.textContent += 'Test Data:\n' + JSON.stringify(testData, null, 2) + '\n\n';
                output.textContent += 'Sending request to /api/register.php...\n';
                
                const response = await fetch('/api/register.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                output.textContent += 'Response Status: ' + response.status + '\n';
                output.textContent += 'Response Headers:\n';
                for (let [key, value] of response.headers.entries()) {
                    output.textContent += '  ' + key + ': ' + value + '\n';
                }
                output.textContent += '\n';
                
                const responseText = await response.text();
                output.textContent += 'Raw Response:\n' + responseText + '\n\n';
                
                try {
                    const result = JSON.parse(responseText);
                    output.textContent += 'Parsed JSON:\n' + JSON.stringify(result, null, 2) + '\n\n';
                    
                    if (result.success) {
                        output.textContent += '✅ SUCCESS! User created.\n';
                        output.textContent += 'Check Supabase table for: ' + testData.email;
                    } else {
                        output.textContent += '❌ FAILED: ' + result.message;
                    }
                } catch (e) {
                    output.textContent += '❌ JSON Parse Error: ' + e.message;
                }
                
            } catch (error) {
                output.textContent += '❌ ERROR: ' + error.message + '\n';
                output.textContent += 'Stack: ' + error.stack;
            }
        });
    </script>
</body>
</html>
